{"metadata":{"modules":{"imports":[],"exports":{"exported":[],"specifiers":[]}},"usedHelpers":[]},"ignored":false,"code":"/**\n * Created on 9/14/15.\n */\n\n{\n    (function () {\n        var PageStore = undefined;\n        Dependency.autorun(function () {\n            PageStore = Dependency.get('classRegister.bookTheSameTimePage.store');\n        });\n\n        Cal.CRBookTheSameTimePage = React.createClass({\n            displayName: \"CRBookTheSameTimePage\",\n\n            mixins: [ReactMeteorData, Cal.Mixins.windowUnload],\n            getMeteorData: function () {\n\n                //todo\n                Meteor.subscribe(\"swimmersByAccountId\", Meteor.userId());\n                //Meteor.subscribe(\"appInfo\");\n                Meteor.subscribe(\"classes\");\n                Meteor.subscribe(\"activeShoppingCart\");\n\n                var data = {\n                    account: Meteor.users.find().fetch(),\n\n                    swimmers: PageStore.getSwimmers().fetch(),\n\n                    currentSwimmer: PageStore.currentSwimmer.get(),\n                    currentLevel: PageStore.currentLevel.get(), //计算过后的值\n\n                    //当前注册课程信息 来自classesRegiser表\n                    nowClasses: PageStore.nowClasses.get(),\n                    registeredClasses: PageStore.registeredClasses.get(),\n                    historyClasses: PageStore.historyClasses.get(),\n                    shoppingCartClasses: PageStore.shoppingCartClasses.get(),\n\n                    //当前swimmer下一个session的 same time class\n                    currentSwimmerSameClasses: PageStore.currentSwimmerSameClasses.get(),\n                    currentSwimmerAvaibleSameClasses: PageStore.currentSwimmerAvaibleSameClasses.get(),\n\n                    ////////////test\n                    //currentSwimmerClasses: PageStore.currentSwimmerClasses.get(),\n                    currentSwimmerType: PageStore.currentSwimmerType.get(),\n\n                    //swimmerClasses: PageStore.swimmerClasses.get(),\n                    //selectClassView: PageStore.selectClassView,\n\n                    //should wait for currentSwimmer\n                    avaiableDays: PageStore.avaiableDays.get(),\n                    avaiableTimes: PageStore.avaiableTimes.get(),\n                    currentDay: PageStore.currentDay.get(),\n                    currentTime: PageStore.currentTime.get(),\n\n                    currentStep: PageStore.currentStep.get(),\n\n                    currentClass: PageStore.currentClass.get(),\n\n                    //一次选课流程的所有信息\n                    selectedClasses: PageStore.selectedClasses.get()\n\n                };\n\n                return data;\n            },\n\n            //formSubmit (e) {\n            //    //两种步骤不同 无法合并\n            //\n            //},\n\n            getCardView: function () {\n\n                //let swimmers = this.data.swimmers.map(function (v, i) {\n                //    return {text: v['name'], value: v._id}\n                //})\n\n                var swimmer = this.data.selectedClasses.get('swimmer');\n                var class1 = this.data.selectedClasses.get('class1');\n                var class2 = this.data.selectedClasses.get('class2');\n                var class3 = this.data.selectedClasses.get('class3');\n\n                return React.createElement(Cal.SelectedClassInfoCard, {\n                    swimmer: swimmer,\n                    selectedClasses: { 'class1': class1, 'class2': class2, 'class3': class3 }\n                });\n            },\n\n            getselectionView: function () {\n\n                // 正在游\n                // 且有sameclass\n                // 且购物车为空\n                // 且步骤为1时 显示bookthesametime\n                if (this.data.currentSwimmerAvaibleSameClasses.length > 0 && !this.data.shoppingCartClasses.length && !this.data.registeredClasses.length) {\n\n                    if (this.data.currentStep == '1-1') {\n                        //可以直接去结账\n\n                        return React.createElement(Cal.CRBookTheSameTimeCurrentConfirm, null);\n                    } else if (this.data.currentStep == 1) {\n                        return React.createElement(Cal.CRBookTheSameTimeCurrent, {\n\n                            swimmers: this.data.swimmers,\n                            currentSwimmer: this.data.currentSwimmer,\n                            currentLevel: this.data.currentLevel,\n\n                            currentSwimmerSameClasses: this.data.currentSwimmerSameClasses,\n                            currentSwimmerAvaibleSameClasses: this.data.currentSwimmerAvaibleSameClasses,\n\n                            currentStep: this.data.currentStep\n                        });\n                    } else {\n                        //2 3\n\n                        return React.createElement(Cal.CRBookTheSameTimeCurrentPreference, {\n                            swimmers: this.data.swimmers,\n                            currentSwimmer: this.data.currentSwimmer,\n                            currentLevel: this.data.currentLevel,\n\n                            avaiableDays: this.data.avaiableDays,\n                            avaiableTimes: this.data.avaiableTimes,\n\n                            currentDay: this.data.currentDay,\n                            currentTime: this.data.currentTime,\n\n                            currentStep: this.data.currentStep,\n\n                            currentClass: this.data.currentClass,\n                            selectedClasses: this.data.selectedClasses\n                        });\n                    }\n                } else {\n\n                    //brother sister 或者 return back\n                    return React.createElement(Cal.CRBookTheSameTimeSibling, {\n\n                        swimmers: this.data.swimmers,\n                        currentSwimmer: this.data.currentSwimmer,\n                        currentLevel: this.data.currentLevel,\n\n                        avaiableDays: this.data.avaiableDays,\n                        avaiableTimes: this.data.avaiableTimes,\n\n                        currentDay: this.data.currentDay,\n                        currentTime: this.data.currentTime,\n\n                        currentStep: this.data.currentStep,\n\n                        currentClass: this.data.currentClass,\n                        selectedClasses: this.data.selectedClasses\n                    });\n                }\n            },\n            onBeforeUnload: function (e) {\n                var message = \"You may lost data, are you sure leving?\";\n                e.returnValue = message;\n                return message;\n            },\n\n            componentWillMount: function () {\n\n                Dispatcher.dispatch({\n                    actionType: \"componentWillMount_CRBookTheSameTimePage\"\n                });\n\n                //尝试清除不完整的购物项\n                Meteor.call('clear_uncompleted_item_in_cart');\n            },\n\n            render: function () {\n\n                //let currentSwimmerValue = this.data.currentSwimmer\n                //    && {\n                //        value: this.data.currentSwimmer._id,\n                //        text: this.data.currentSwimmer.name\n                //    }\n                //console.log(this.data.currentSwimmerClasses)\n                //\n                //\n\n                return React.createElement(\n                    \"div\",\n                    null,\n                    this.getCardView(),\n                    this.getselectionView()\n                );\n            }\n\n        });\n    })();\n}","ast":null,"map":{"version":3,"sources":["/client/app/class.register/bookTheSameTime/BookTheSameTimePage.jsx"],"names":[],"mappings":"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","file":"/client/app/class.register/bookTheSameTime/BookTheSameTimePage.jsx.map","sourcesContent":["/**\n * Created on 9/14/15.\n */\n\n\n{\n    let PageStore;\n    Dependency.autorun(function () {\n        PageStore = Dependency.get('classRegister.bookTheSameTimePage.store');\n    });\n\n\n    Cal.CRBookTheSameTimePage = React.createClass({\n        mixins: [ReactMeteorData, Cal.Mixins.windowUnload],\n        getMeteorData() {\n\n            //todo\n            Meteor.subscribe(\"swimmersByAccountId\", Meteor.userId());\n            //Meteor.subscribe(\"appInfo\");\n            Meteor.subscribe(\"classes\");\n            Meteor.subscribe(\"activeShoppingCart\");\n\n\n            var data = {\n                account: Meteor.users.find().fetch(),\n\n                swimmers: PageStore.getSwimmers().fetch(),\n\n                currentSwimmer: PageStore.currentSwimmer.get(),\n                currentLevel:PageStore.currentLevel.get(), //计算过后的值\n\n                //当前注册课程信息 来自classesRegiser表\n                nowClasses:PageStore.nowClasses.get(),\n                registeredClasses:PageStore.registeredClasses.get(),\n                historyClasses:PageStore.historyClasses.get(),\n                shoppingCartClasses:PageStore.shoppingCartClasses.get(),\n\n\n                //当前swimmer下一个session的 same time class\n                currentSwimmerSameClasses:PageStore.currentSwimmerSameClasses.get(),\n                currentSwimmerAvaibleSameClasses:PageStore.currentSwimmerAvaibleSameClasses.get(),\n\n                ////////////test\n                //currentSwimmerClasses: PageStore.currentSwimmerClasses.get(),\n                currentSwimmerType: PageStore.currentSwimmerType.get(),\n\n                //swimmerClasses: PageStore.swimmerClasses.get(),\n                //selectClassView: PageStore.selectClassView,\n\n                //should wait for currentSwimmer\n                avaiableDays: PageStore.avaiableDays.get(),\n                avaiableTimes: PageStore.avaiableTimes.get(),\n                currentDay: PageStore.currentDay.get(),\n                currentTime: PageStore.currentTime.get(),\n\n                currentStep: PageStore.currentStep.get(),\n\n                currentClass:PageStore.currentClass.get(),\n\n                //一次选课流程的所有信息\n                selectedClasses: PageStore.selectedClasses.get()\n\n            }\n\n\n            return data;\n\n        },\n\n        //formSubmit (e) {\n        //    //两种步骤不同 无法合并\n        //\n        //},\n\n        getCardView(){\n\n\n            //let swimmers = this.data.swimmers.map(function (v, i) {\n            //    return {text: v['name'], value: v._id}\n            //})\n\n            let swimmer = this.data.selectedClasses.get('swimmer')\n            let class1 = this.data.selectedClasses.get('class1')\n            let class2 = this.data.selectedClasses.get('class2')\n            let class3 = this.data.selectedClasses.get('class3')\n\n            return <Cal.SelectedClassInfoCard\n                swimmer={swimmer}\n                selectedClasses={{'class1':class1,'class2':class2,'class3':class3}}\n                />\n\n        },\n\n        getselectionView(){\n\n            // 正在游\n            // 且有sameclass\n            // 且购物车为空\n            // 且步骤为1时 显示bookthesametime\n            if(this.data.currentSwimmerAvaibleSameClasses.length>0\n                && !this.data.shoppingCartClasses.length\n                && !this.data.registeredClasses.length){\n\n                if(this.data.currentStep== '1-1'){  //可以直接去结账\n\n                    return <Cal.CRBookTheSameTimeCurrentConfirm />\n\n                }else if(this.data.currentStep== 1){\n                    return <Cal.CRBookTheSameTimeCurrent\n\n                        swimmers={this.data.swimmers}\n                        currentSwimmer={this.data.currentSwimmer}\n                        currentLevel={this.data.currentLevel}\n\n                        currentSwimmerSameClasses={this.data.currentSwimmerSameClasses}\n                        currentSwimmerAvaibleSameClasses={this.data.currentSwimmerAvaibleSameClasses}\n\n                        currentStep={this.data.currentStep}\n                        />\n\n                }else{ //2 3\n\n                    return <Cal.CRBookTheSameTimeCurrentPreference\n                        swimmers={this.data.swimmers}\n                        currentSwimmer={this.data.currentSwimmer}\n                        currentLevel={this.data.currentLevel}\n\n\n                        avaiableDays={this.data.avaiableDays}\n                        avaiableTimes={this.data.avaiableTimes}\n\n                        currentDay={this.data.currentDay}\n                        currentTime={this.data.currentTime}\n\n                        currentStep={this.data.currentStep}\n\n                        currentClass={this.data.currentClass}\n                        selectedClasses={this.data.selectedClasses}\n                        />\n\n                }\n\n\n            }else{\n\n\n                //brother sister 或者 return back\n                return <Cal.CRBookTheSameTimeSibling\n\n                    swimmers={this.data.swimmers}\n                    currentSwimmer={this.data.currentSwimmer}\n                    currentLevel={this.data.currentLevel}\n\n\n                    avaiableDays={this.data.avaiableDays}\n                    avaiableTimes={this.data.avaiableTimes}\n\n                    currentDay={this.data.currentDay}\n                    currentTime={this.data.currentTime}\n\n                    currentStep={this.data.currentStep}\n\n                    currentClass={this.data.currentClass}\n                    selectedClasses={this.data.selectedClasses}\n                    />\n\n            }\n\n        },\n        onBeforeUnload(e){\n            var message = \"You may lost data, are you sure leving?\";\n            e.returnValue = message;\n            return message;\n        },\n\n        componentWillMount(){\n\n            Dispatcher.dispatch({\n                actionType: \"componentWillMount_CRBookTheSameTimePage\"\n            });\n\n            //尝试清除不完整的购物项\n            Meteor.call('clear_uncompleted_item_in_cart')\n\n        },\n\n        render() {\n\n\n            //let currentSwimmerValue = this.data.currentSwimmer\n            //    && {\n            //        value: this.data.currentSwimmer._id,\n            //        text: this.data.currentSwimmer.name\n            //    }\n            //console.log(this.data.currentSwimmerClasses)\n            //\n            //\n\n\n            return <div>\n\n\n\n                {this.getCardView()}\n\n\n                {this.getselectionView()}\n\n\n            </div>\n        }\n\n    })\n\n}"]},"hash":"001cdbd689863142c2e05a5e0385201b78273b23"}
