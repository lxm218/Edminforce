{"version":3,"sources":["meteor://ğŸ’»app/client/app/class.register/ShoppingCart.model.jsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;;AAEI,QAAI,gBAAgB,aAAC;AACrB,cAAU,CAAC,OAAO,CAAC,YAAY;AAC3B,wBAAgB,GAAG,UAAU,CAAC,GAAG,CAAC,qCAAqC,CAAC,CAAC;KAC5E,CAAC,CAAC;;AAGH,cAAU,CAAC,GAAG,CAAC,kCAAkC,EAAE,IAAI,YAAY;;;AAI/D,iBAAS,iBAAiB,GAAG;;AAEzB,gBAAI,IAAI,GAAG,EAAE,CAAC,YAAY,CAAC,OAAO,EAAE;;AAEpC,mBAAO,IAAI,IAAI,IAAI,CAAC,GAAG;SAC1B;;;AAGD,iBAAS,gBAAgB,CAAC,MAAM,EAAE,IAAI,EAAE;;AAEpC,cAAE,CAAC,eAAe,CAAC,MAAM,CAAC;AACtB,yBAAS,EAAE,GAAG,CAAC,IAAI,CAAC,eAAe;AACnC,yBAAS,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG;AAC3B,uBAAO,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG;AACxB,sBAAM,EAAE;AACJ,kCAAc,EAAE,MAAM;iBACzB;;aAEJ,EAAE,UAAU,GAAG,EAAE,GAAG,EAAE;AACnB,mBAAG,IAAI,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;;;;aAI5B,CAAC;SACL;;;AAGD,iBAAS,eAAe,CAAC,IAAI,EAAE;;;;AAI3B,gBAAI,MAAM,GAAG,iBAAiB,EAAE;AAChC,gBAAI,MAAM,EAAE;;;;AAIR,kBAAE,CAAC,YAAY,CAAC,MAAM,CAAC;AACf,yBAAK,EAAE,MAAM;iBAChB,EAAE;AACC,2BAAO,EAAE;AACL,+BAAO,EAAE,IAAI;qBAChB;iBACJ,EACC,UAAU,GAAG,EAAE,GAAG,EAAE;AAClB,uBAAG,IAAI,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC;;;AAGzB,wBAAG,CAAC,GAAG,EAAE,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC;iBAC1C,CAAC;aAET,MAAM;;AAEH,oBAAI,YAAY,GAAG;AACf,0BAAM,EAAE,QAAQ;AAChB,6BAAS,EAAE,MAAM,CAAC,MAAM,EAAE;AAC1B,6BAAS,EAAE,GAAG,CAAC,IAAI,CAAC,eAAe;AACnC,yBAAK,EAAE,CAAC,IAAI,CAAC;iBAChB;;;AAGD,kBAAE,CAAC,YAAY,CAAC,MAAM,CAAC,YAAY,EAAE,UAAU,GAAG,EAAE,MAAM,EAAE;AACxD,wBAAI,GAAG,EAAE;AACL,+BAAO,CAAC,KAAK,CAAC,GAAG,CAAC;AAClB,+BAAM;qBACT;;AAED,wBAAG,CAAC,GAAG,EAAE,gBAAgB,CAAC,MAAM,EAAE,IAAI,CAAC;iBAC1C,CAAC;aACL;SAEJ;;;;;;;;;;AAWD,iBAAS,kBAAkB,CAAC,aAAa,EAAE,QAAQ,EAAC,QAAQ,EAAE;AAC1D,gBAAI,MAAM,GAAG,iBAAiB,EAAE;;AAEhC,oBAAQ,CAAC,aAAa,GAAG,aAAa;;AAEtC,gBAAI,MAAM,EAAE;AACR,wBAAQ,CAAC,MAAM,GAAG,MAAM,CAAC;;AAEzB,sBAAM,CAAC,IAAI,CACP,uBAAuB,EACvB,QAAQ,EACR,UAAU,KAAK,EAAE,MAAM,EAAE;AACrB,4BAAQ,IAAI,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC;iBACtC,CAAC;aACT,MAAM;AACH,wBAAQ,IAAI,QAAQ,CAAC,EAAC,IAAI,EAAC,wBAAwB,EAAC,CAAC;aACxD;SACJ;;;;;AAOD,eAAO;AACH,6BAAiB,EAAE,iBAAiB;AACpC,4BAAgB,EAAE,gBAAgB;AAClC,2BAAe,EAAE,eAAe;AAChC,8BAAkB,EAAE,kBAAkB;SACzC;KAGJ,GAAC;CAGL,wE","file":"/client/app/class.register/ShoppingCart.model.jsx","sourcesContent":["/**\n * Created on 9/19/15.\n */\n\n//@@@@@@@@@ TODO this file is not used now and will be deleted later.\n//All the logic have been moved to server side as meteor.methods\n\n//ShoppingCart  è´­ç‰©è½¦æ“ä½œå‡½æ•°\n//ä¸æ˜¯ä¸€ä¸ªstore æ‰€ä»¥ä¸æ¥å—æ¶ˆæ¯ï¼Œå¯æš´éœ²setå‡½æ•°ã€‚ åœ¨éœ€è¦çš„åœ°æ–¹ç›´æ¥å¼•ç”¨å’Œè°ƒç”¨\n//todo è´­ç‰©è½¦çš„æ‰€æœ‰æ“ä½œå…¨éƒ¨é€šè¿‡ Meteor.call å®Œæˆï¼Ÿ æ£€æŸ¥å“ªäº›æ•°æ®é¿å…æš´éœ²åˆ°å‰ç«¯\n\n/******************è´­ç‰©è½¦æ•°æ®æ ¼å¼******************\n\n let shoppingCart = {\n status: 'active',\n accountId: 'account1',\n sessionId: 'testSession2',\n items: [item]\n }\n\n //swimmer._id  å’Œ class1._id ç¡®å®šä¸€ä¸ªitem\n //class1ä¼šå ç”¨classåé¢\n //class2 class3ä¸ºç”¨æˆ·çš„å¤‡é€‰class\n //è¿™é‡Œä¸ä½¿ç”¨idæ˜¯ä¸ºäº†å‡å°‘è´¦å•ä¿¡æ¯æŸ¥è¯¢ ä¹Ÿå¯ä»¥ä¿å­˜ç”¨æˆ·è´­ç‰©æ—¶å„é¡¹ç›®çš„ä¿¡æ¯\n itemï¼{\n    swimmer:object,\n    class1:object,\n    class2:object,\n    class3:object\n }\n\n****************************************/\n\n{\n    //ç”¨äºè·å–ç”¨æˆ·å½“å‰çš„é€‰æ‹©ä¿¡æ¯\n    let selectClassStore;\n    Dependency.autorun(function () {\n        selectClassStore = Dependency.get('classRegister.SelectClassPage.store');\n    });\n\n\n    Dependency.add('classRegister.ShoppingCart.model', new function () {\n\n\n        /////////public ///////////\n        function getShoppingCartId() {\n            //active\n            var cart = DB.ShoppingCart.findOne()\n\n            return cart && cart._id\n        }\n\n        //æ·»åŠ é€‰è¯¾çºªå½• step1\n        function addClassRegister(cartId, item) {\n\n            DB.ClassesRegister.insert({\n                sessionId: App.info.sessionRegister,\n                swimmerId: item.swimmer._id,\n                classId: item.class1._id,\n                carted: {\n                    shoppingCardId: cartId\n                }\n\n            }, function (err, _id) {\n                err && console.error(err)\n\n                //self.currentStep.set(2)\n                //self.currentDay.set({value:false}) //é‡ç½®æ—¶é—´\n            })\n        }\n\n        //{swimmerId ,classId}\n        function addShoppingItem(item) {\n            //æ˜¯å¦é‡å¤é€»è¾‘\n            //push\n\n            var cartId = getShoppingCartId()\n            if (cartId) {\n\n                //todo !!!classæ˜¯å¦é‡å¤çš„åˆ¤æ–­é€»è¾‘  ä¸€ä¸ªswimmerå¯¹ç‰¹å®šclassåªèƒ½é€‰ä¸€ä¸ª\n                //æ”¹ç”¨meteor.call åå°åˆ¤æ–­åº”æ›´æ–¹ä¾¿\n                DB.ShoppingCart.update({\n                        '_id': cartId\n                    }, {\n                        '$push': {\n                            'items': item\n                        }\n                    }\n                    , function (err, _id) {\n                        err && console.error(err)\n\n                        //æ·»åŠ é€‰è¯¾çºªå½•\n                        if(!err) addClassRegister(cartId, item)\n                    })\n\n            } else {\n\n                let shoppingCart = {\n                    status: 'active',\n                    accountId: Meteor.userId(),\n                    sessionId: App.info.sessionRegister,\n                    items: [item]\n                }\n\n                //åˆ›å»ºè´­ç‰©è½¦\n                DB.ShoppingCart.insert(shoppingCart, function (err, cartId) {\n                    if (err) {\n                        console.error(err)\n                        return\n                    }\n                    //æ·»åŠ é€‰è¯¾çºªå½•\n                    if(!err) addClassRegister(cartId, item)\n                })\n            }\n\n        }\n\n        /*******\n\n         preferenceNum: {Number}\n         paramObj:{\n            'swimmer': swimmer,\n             'class1':  class1,\n             data: currentClass\n         }\n         **/\n        function addClassPreference(preferenceNum, paramObj,callback) {\n            var cartId = getShoppingCartId()\n\n            paramObj.preferenceNum = preferenceNum\n\n            if (cartId) {\n                paramObj.cartId = cartId;\n\n                Meteor.call(\n                    'upsertClassPreference',\n                    paramObj,\n                    function (error, result) {\n                        callback && callback(error, result)\n                    })\n            } else {\n                callback && callback({info:'there is no valid cart'})\n            }\n        }\n\n\n        /////////private ///////////\n\n\n        //interface\n        return {\n            getShoppingCartId: getShoppingCartId,\n            addClassRegister: addClassRegister,\n            addShoppingItem: addShoppingItem,\n            addClassPreference: addClassPreference\n        }\n\n\n    })\n\n\n}\n\n"]}